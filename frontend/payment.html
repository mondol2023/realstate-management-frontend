<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Payment </title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <nav class="navbar">
            <div class="logo">Realstate Management</div>
            <ul class="nav-links">
            <li><a href="index.html">Home</a></li>
            <li><a href="listings.html">Listings</a></li>
            <li><a href="booking.html">Booking</a></li>
            <li><a href="login.html">Login</a></li>
            </ul>
        </nav>

        <main class="payment-container">
            <h2>Payment</h2>
            <form id="paymentForm" class="payment-form">
            <input type="hidden" id="bookingId">

            <label>Cardholder Name</label>
            <input type="text" id="name" required>

            <label>Card Number</label>
            <input type="text" id="cardNumber" maxlength="16" required>

            <label>Expiry Date</label>
            <input type="text" id="expiry" placeholder="MM/YY" required>

            <label>CVV</label>
            <input type="text" id="cvv" maxlength="4" required>

            <button type="submit" class="btn">Pay Now</button>
            </form>
        </main>

        <script>
          
            const params = new URLSearchParams(window.location.search);
            const bookingId = params.get("bookingId");
            if (bookingId) document.getElementById("bookingId").value = bookingId;

            document.getElementById("paymentForm").addEventListener("submit", (e) => {
                e.preventDefault();
                
                if (!bookingId) {
                    alert("Error: No booking ID found.");
                    return;
                }

                const bookings = JSON.parse(localStorage.getItem("bookings")) || [];
                
                const bookingIndex = bookings.findIndex(b => b._id === bookingId);

                if (bookingIndex !== -1) {
                    bookings[bookingIndex].paymentStatus = "Paid";
                    
                    localStorage.setItem("bookings", JSON.stringify(bookings));
                    
                    alert("Payment successful!");
                    window.location.href = "index.html";
                } else {
                    alert("Booking not found. Payment failed.");
                }
            });

            
            document.addEventListener("DOMContentLoaded", () => {
                const navLinks = document.querySelector(".nav-links");
                const currentUser = JSON.parse(sessionStorage.getItem("currentUser"));

                if (currentUser) {
                    
                    navLinks.innerHTML = `
                        <li><a href="index.html">Home</a></li>
                        <li><a href="listings.html">Listings</a></li>
                        <li><a href="dashboard.html">Dashboard</a></li>
                        <li><a href="#" onclick="logout()">Logout</a></li>
                    `;
                } else {
                   
                    navLinks.innerHTML = `
                        <li><a href="index.html">Home</a></li>
                        <li><a href="listings.html">Listings</a></li>
                        <li><a href="login.html">Login</a></li>
                        <li><a href="register.html">Register</a></li>
                    `;
                }
            });

            function logout() {
                sessionStorage.removeItem("currentUser");
                window.location.href = "index.html";
            }
        </script>
    </body>
</html>
